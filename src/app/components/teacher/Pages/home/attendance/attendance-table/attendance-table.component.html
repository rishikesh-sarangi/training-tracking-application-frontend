<div class="batches-program-component">
  <div class="table-responsive" *ngIf="isAttendanceAvailable">
    <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows>
      <form [formGroup]="attendanceReactiveForm">
        <!-- actions -->
        <ng-container matColumnDef="actions">
          <th
            mat-header-cell
            *matHeaderCellDef
            mat-sort-header
            style="width: 22%"
          >
            Actions
          </th>
          <td mat-cell *matCellDef="let row; let i = dataIndex">
            <div class="action-buttons">
              <span
                *ngIf="i != editingRowID; else editMode"
                class="action-buttons"
              >
                <mat-icon (click)="editAttendance(i, row)">
                  <span class="material-icons-outlined"> edit </span>
                </mat-icon>
                <mat-icon (click)="deleteAttendance(row)"
                  ><span class="material-icons-outlined">
                    delete
                  </span></mat-icon
                > </span
              ><span style="font-size: 25px">|</span>
              <span
                (click)="toggleTable(row)"
                class="mark-students"
                [ngClass]="{ 'disabled-text': isMarkStudentsClicked }"
                [attr.disabled]="isMarkStudentsClicked ? true : null"
              >
                Mark Students
              </span>
              <ng-template #editMode>
                <span class="action-buttons">
                  <mat-icon
                    ><span
                      class="material-icons-outlined"
                      (click)="saveAttendance(row)"
                    >
                      done
                    </span></mat-icon
                  >
                  <mat-icon (click)="cancelEditing()">
                    <span class="material-icons-outlined"> close </span>
                  </mat-icon>
                </span></ng-template
              >
            </div>
          </td>
        </ng-container>

        <!-- topic name-->
        <ng-container matColumnDef="topicName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Topic Name</th>
          <td mat-cell *matCellDef="let row; let i = dataIndex">
            <ng-container *ngIf="i != editingRowID; else editMode">
              <div>
                {{ row.topicName }}
              </div>
            </ng-container>
            <ng-template #editMode>
              <mat-form-field appearance="outline" class="dense-form-field-5">
                <input matInput formControlName="topicName" />
                <mat-error>Field must not be empty</mat-error>
              </mat-form-field>
            </ng-template>
          </td>
        </ng-container>

        <!-- topic percentage completed -->
        <ng-container matColumnDef="topicPercentageCompleted">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            Topic Percentage Completed
          </th>
          <td mat-cell *matCellDef="let row; let i = dataIndex">
            <ng-container *ngIf="i != editingRowID; else editMode">
              <div>
                {{ row.topicPercentageCompleted }}
              </div>
            </ng-container>
            <ng-template #editMode>
              <mat-form-field appearance="outline" class="dense-form-field-5">
                <input matInput formControlName="topicPercentageCompleted" />
                <mat-error>Field must not be empty</mat-error>
              </mat-form-field>
            </ng-template>
          </td>
        </ng-container>

        <!-- expansion Table -->
        <!-- Inside the expansion Table -->
        <ng-container matColumnDef="markStudentsTable">
          <td
            mat-cell
            *matCellDef="let row2"
            [attr.colspan]="displayedColumns.length"
          >
            <div
              [@detailExpand]="
                row2 === expandedRowTable ? 'expanded' : 'collapsed'
              "
              class="example-element-detail"
            >
              <ng-container *ngIf="row2 === expandedRowTable">
                <!-- logic for attendance -->
              </ng-container>
            </div>
          </td>
        </ng-container>
      </form>
      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumns"
        style="background-color: #f0f6ff"
      ></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        style="background-color: #f0f6ff"
      ></tr>
      <tr
        mat-row
        *matRowDef="let row2; columns: ['markStudentsTable']"
        class="example-detail-row"
        style="background-color: #f0f6ff"
      ></tr>
    </table>
  </div>
  <div *ngIf="!isAttendanceAvailable">No Evaluation Available</div>
</div>
